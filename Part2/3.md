# 自定义chart图配置

### 一、使用场景

对现有组件库里面的echart图组件通过修改option的方式进行自定义

<img src="/img/iShot2022-02-16 16.50.24.png"  width="700"   />

### 二、使用说明

1、为组件添加图表属性组件

```
static getEditProps() {
    const propsCmp = [
    	...
      {
        pType: 'PropsSetOption',
        name: '',
        key: 'customProps',
        defaultValue: {
          SoureSet: {},
          DataJson: '',
        },
      },
    ];
    return propsCmp;
  }
```

2、组件内对接属性option

这边有个点，属性弹出框的左侧展示现有的option，所以是需要让属性组件获取模版上组件的实例，问题就变成了父组件如何获取子组件的实例，需要分两个情况考虑

一、子组件是class组件：需要调用父组件的函数传入this，然后还要处理option这部分逻辑已经抽出公共方法`GetCustomConfig`，参考案例对接即可

```
import { GetCustomConfig } from '&util/chartUtil'; //这里

componentDidMount() {
	this.props.onRef && this.props.onRef(this); //这里
	//...省略其他代码
}

changeOptions = () => {
    let { parseData, data } = this.props;
    let _parseData = parseData;
    let option = _parseData && chartsConfig(data, _parseData);
    // 原来的代码
    // option && this.chart.setOption(option, true);
    // 修改后
    this.option = GetCustomConfig(data.customProps, option, this.props); //这里
    this.option && this.chart.setOption(this.option, true);
}
```

二、子组件是函数组件：函数组件没有this，通过useRef()实现一个类似实例字段的方式，useEffct中调用父组件的函数传入ref.curren，还要处理option，这部分逻辑已经抽出了一个公共的hooks`useSetChartOption`，参考案例对接即可

```
import useSetChartOption from '&common/hooks/useSetChartOption';
const setChartOption = useSetChartOption(props);// 这里

useEffect(() => {
    let option = createOptions(customProps,renderData.Data);
    setChartOption(option); // 这里
    chartRef.current.setOption(option, true);
}, [customProps]);
```

3、弹出框输入函数，根据原始option和props返回一个新的option

<img src="/img/iShot2022-02-08 15.46.29.png"  width="700"   />

### 三、案例参考

class组件对接参考：AssessmentResults360【ux-smart-report】

函数组件对接参考：BaseChartOption【scomp-proj-scomproj-new】

组件配置参考：https://smartreport.italent-inc.cn/#/?templateId=153c1b3f-900b-4a6c-95cc-59d54f0203cc&shadow_context=%7BappModel%3A%22italent%22%2Cuppid%3A%22%22%7D&dev=1模版里面的雷达图组件
